setpref targetPlatformPath="${target.platform}"

#resolve "${projects.location}/xtraitj.buckminster/build.cquery"

resolve "${projects.location}/xtraitj.buckminster/projects-platform.cquery"
resolve "${projects.location}/xtraitj.buckminster/project.cquery"

clean

# this first Java build will fail with compilation errors, since Xtend
# classes have not been compiled yet.  However, it will compile some
# Java classes so that we will be able to compile Xtend classes
build --continueonerror

launch --stderr --stdout -l "xtraitj/XtendCompiler.launch"
build --continueonerror

launch --stderr --stdout -l "xtraitj.ui/XtendCompiler.launch"
build --continueonerror

launch --stderr --stdout -l "xtraitj.tests/XtendCompiler.launch"
build --continueonerror

launch --stderr --stdout -l "xtraitj.swtbot.tests/XtendCompiler.launch"


build --clean

emma -l "xtraitj.tests/xtraitj.ui.tests.launch"  --output "${buckminster.output.root}/test.results/xtraitj.ui.tests.launch.xml" --exec "${buckminster.output.root}/test.results/coverage.xtraitj.ui.tests.launch.exec" --html "${buckminster.output.root}/test.results/coverage.xtraitj.ui.tests.launch.html" --flatXML 
emma -l "xtraitj.tests/xtraitj.tests.launch" --output "${buckminster.output.root}/test.results/xtraitj.tests.launch.xml" --exec "${buckminster.output.root}/test.results/coverage.xtraitj.tests.launch.exec" --html "${buckminster.output.root}/test.results/coverage.xtraitj.tests.launch.html" --flatXML --stdout --stderr --maxTimeAwaitJunitReport 120 

# Swtbot tests
emma -l "xtraitj.swtbot.tests/XtraitjSwtbotTests.launch"  --output "${buckminster.output.root}/test.results/xtraitj.XtraitjSwtbotTests.launch.xml" --exec "${buckminster.output.root}/test.results/coverage.XtraitjSwtbotTests.launch.exec" --html "${buckminster.output.root}/test.results/coverage.XtraitjSwtbotTests.launch.html" --flatXML

perform "xtraitj.site#site.p2"
